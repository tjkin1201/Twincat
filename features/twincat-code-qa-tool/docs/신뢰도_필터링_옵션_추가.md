# TwinCAT QA CLI 신뢰도 기반 필터링 옵션 추가

## 개요
`QaCommand.cs` 파일에 신뢰도 기반 필터링 및 억제 관리 기능을 추가했습니다.

## 추가된 CLI 옵션

### 1. `--min-confidence` / `-c`
**설명:** 최소 신뢰도 레벨 필터링
**기본값:** `low`
**사용 가능한 값:**
- `high`: 90% 이상 신뢰도 (거의 확실한 문제만 표시)
- `medium`: 60% 이상 신뢰도 (검토 필요한 이슈 포함)
- `low`: 모든 신뢰도 레벨 (기본값)

**사용 예시:**
```bash
# High 신뢰도 이슈만 표시
twincat-qa qa ./old ./new --min-confidence high

# 약어 사용
twincat-qa qa ./old ./new -c medium
```

### 2. `--show-suppressed`
**설명:** 억제된 이슈도 표시 여부
**기본값:** `false` (억제된 이슈 숨김)
**타입:** Boolean 플래그

**사용 예시:**
```bash
# 억제된 이슈도 함께 표시
twincat-qa qa ./old ./new --show-suppressed
```

### 3. `--config`
**설명:** `.twincat-qa.json` 설정 파일 경로
**기본값:** 없음 (선택적)
**타입:** 파일 경로

**사용 예시:**
```bash
# 설정 파일 지정
twincat-qa qa ./old ./new --config ./.twincat-qa.json
```

**설정 파일 형식 예시 (`.twincat-qa.json`):**
```json
{
  "suppressions": [
    {
      "ruleId": "QA001",
      "filePath": "*.TcPOU",
      "reason": "레거시 코드, 점진적 개선 예정"
    }
  ],
  "minConfidence": "medium",
  "excludeRules": ["QA999"]
}
```

## 출력 형식 변경

### 신뢰도 정보 표시
이슈 출력 시 신뢰도 레벨과 점수를 표시합니다:

**출력 예시:**
```
[QA001] 🔴 Critical ⭐[High 95%] - 타입 축소 위험
  📍 Program.TcPOU:42
  📝 INT에서 BYTE로 타입이 축소되었습니다

[QA002] 🟡 Warning ⚡[Medium 75%] - 미사용 변수 감지
  📍 FunctionBlock.TcPOU:15
  📝 변수 'tempValue'가 선언되었으나 사용되지 않습니다

[QA003] 🔵 Info ❓[Low 45%] [억제됨] - 주석 부족
  📍 Main.TcPOU:8
  📝 함수 블록에 한글 주석이 부족합니다
```

**아이콘 의미:**
- ⭐ High 신뢰도 (90%+)
- ⚡ Medium 신뢰도 (60-89%)
- ❓ Low 신뢰도 (<60%)
- [억제됨] - 설정에 의해 억제된 이슈

## 구현 세부사항

### 추가된 파서 메서드
```csharp
private static ConfidenceLevel ParseConfidenceLevel(string confidenceStr)
{
    return confidenceStr.ToLower() switch
    {
        "high" => ConfidenceLevel.High,
        "medium" => ConfidenceLevel.Medium,
        "low" => ConfidenceLevel.Low,
        _ => ConfidenceLevel.Low
    };
}
```

### PrintIssue 메서드 개선
- `EnhancedQAIssue` 타입 확인
- 신뢰도 레벨에 따른 아이콘 표시
- 신뢰도 점수 퍼센트 표시
- 억제 상태 표시

### TODO 항목

현재 구현은 CLI 인터페이스만 추가되었으며, 실제 필터링 로직은 아직 적용되지 않았습니다.

**완료 필요한 작업:**

1. **EnhancedQAAnalysisService DI 등록**
   ```csharp
   // TODO: ServiceCollectionExtensions.cs에 추가
   services.AddScoped<EnhancedQAAnalysisService>();
   ```

2. **신뢰도 필터링 로직 활성화**
   ```csharp
   // QaCommand.cs Line 203-209 주석 해제 및 수정
   var filteredIssues = result.Issues
       .Where(i => i is EnhancedQAIssue enhanced
           ? (enhanced.Confidence >= minConfidence && (showSuppressed || !enhanced.IsSuppressed))
           : true)
       .ToList();
   ```

3. **설정 파일 파싱 구현**
   ```csharp
   // QaCommand.cs Line 166-170 구현
   if (!string.IsNullOrWhiteSpace(configPath))
   {
       var config = await ConfigurationLoader.LoadAsync(configPath);
       // 억제 규칙 적용
   }
   ```

4. **QaAnalysisResult를 EnhancedQAIssue 지원하도록 수정**
   ```csharp
   // QaAnalysisResult.cs
   public List<EnhancedQAIssue> Issues { get; set; } = new();
   ```

## 사용 시나리오

### 시나리오 1: CI/CD 파이프라인에서 엄격한 검증
```bash
# Critical 및 High 신뢰도 이슈만 검사
twincat-qa qa ./old ./new \
  --min-severity critical \
  --min-confidence high \
  --json > qa-results.json
```

### 시나리오 2: 개발 중 전체 이슈 확인
```bash
# 억제된 이슈 포함, 모든 신뢰도 레벨 표시
twincat-qa qa ./old ./new \
  --min-confidence low \
  --show-suppressed \
  --verbose
```

### 시나리오 3: 프로젝트 설정 기반 검증
```bash
# 프로젝트 설정 파일 사용
twincat-qa qa ./old ./new \
  --config ./.twincat-qa.json \
  --format html \
  --output ./reports
```

## 관련 파일

- **수정된 파일:** `src/TwinCatQA.CLI/Commands/QaCommand.cs`
- **관련 모델:** `src/TwinCatQA.Domain/Models/QA/EnhancedQAIssue.cs`
- **관련 서비스:** `src/TwinCatQA.Application/Services/EnhancedQAAnalysisService.cs`

## 주의사항

1. **현재는 UI 레이어만 구현됨**: 실제 필터링 로직은 TODO로 표시된 부분을 구현해야 작동합니다.
2. **EnhancedQAAnalysisService 빌드 오류**: Application 프로젝트의 로거 관련 오류를 먼저 수정해야 전체 빌드가 가능합니다.
3. **하위 호환성**: 기존 `QAIssue`도 계속 지원하며, `EnhancedQAIssue`가 있는 경우에만 신뢰도 정보를 표시합니다.

## 다음 단계

1. `EnhancedQAAnalysisService.cs` 로거 오류 수정
2. DI 컨테이너에 `EnhancedQAAnalysisService` 등록
3. 설정 파일 로더 구현
4. 필터링 로직 활성화 및 테스트
5. 통합 테스트 및 문서화 완료
