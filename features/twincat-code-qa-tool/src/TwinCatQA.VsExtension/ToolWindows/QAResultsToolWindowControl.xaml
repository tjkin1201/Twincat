<UserControl x:Class="TwinCatQA.VsExtension.ToolWindows.QAResultsToolWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             Background="{DynamicResource {x:Static vsshell:VsBrushes.WindowKey}}">

    <UserControl.Resources>
        <!-- ìŠ¤íƒ€ì¼ ì •ì˜ -->
        <Style x:Key="ToolBarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarMouseOverBackgroundGradientKey}}"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="TreeViewItemStyle" TargetType="TreeViewItem">
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
        </Style>

        <!-- HierarchicalDataTemplate for TreeView -->
        <HierarchicalDataTemplate x:Key="ViolationTemplate" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal" ToolTip="{Binding ToolTip}">
                <Image Source="{Binding IconPath}" Width="16" Height="16" Margin="0,0,4,0"/>
                <TextBlock Text="{Binding DisplayName}" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding ViolationCount, StringFormat=' ({0})'}"
                          VerticalAlignment="Center"
                          Visibility="{Binding ViolationCount, Converter={StaticResource CountToVisibilityConverter}}"
                          Foreground="Gray"/>
            </StackPanel>
        </HierarchicalDataTemplate>

        <!-- ê°’ ë³€í™˜ê¸° -->
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- íˆ´ë°” -->
            <RowDefinition Height="Auto"/>
            <!-- í•„í„°/ê²€ìƒ‰ -->
            <RowDefinition Height="*"/>
            <!-- íŠ¸ë¦¬ë·° -->
            <RowDefinition Height="Auto"/>
            <!-- ìƒíƒœë°” -->
        </Grid.RowDefinitions>

        <!-- íˆ´ë°” -->
        <ToolBarTray Grid.Row="0" Background="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarGradientKey}}">
            <ToolBar>
                <Button x:Name="RefreshButton"
                       Style="{StaticResource ToolBarButtonStyle}"
                       Click="RefreshButton_Click"
                       ToolTip="ìƒˆë¡œê³ ì¹¨ (F5)">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ”„" Margin="0,0,4,0"/>
                        <TextBlock Text="ìƒˆë¡œê³ ì¹¨"/>
                    </StackPanel>
                </Button>

                <Separator/>

                <Button x:Name="ExpandAllButton"
                       Style="{StaticResource ToolBarButtonStyle}"
                       Click="ExpandAllButton_Click"
                       ToolTip="ëª¨ë‘ íŽ¼ì¹˜ê¸°">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‚" Margin="0,0,4,0"/>
                        <TextBlock Text="ëª¨ë‘ íŽ¼ì¹˜ê¸°"/>
                    </StackPanel>
                </Button>

                <Button x:Name="CollapseAllButton"
                       Style="{StaticResource ToolBarButtonStyle}"
                       Click="CollapseAllButton_Click"
                       ToolTip="ëª¨ë‘ ì ‘ê¸°">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“" Margin="0,0,4,0"/>
                        <TextBlock Text="ëª¨ë‘ ì ‘ê¸°"/>
                    </StackPanel>
                </Button>

                <Separator/>

                <Button x:Name="ExportButton"
                       Style="{StaticResource ToolBarButtonStyle}"
                       Click="ExportButton_Click"
                       ToolTip="ê²°ê³¼ ë‚´ë³´ë‚´ê¸°">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ’¾" Margin="0,0,4,0"/>
                        <TextBlock Text="ë‚´ë³´ë‚´ê¸°"/>
                    </StackPanel>
                </Button>

                <Separator/>

                <Button x:Name="SettingsButton"
                       Style="{StaticResource ToolBarButtonStyle}"
                       Click="SettingsButton_Click"
                       ToolTip="ì„¤ì •">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âš™ï¸" Margin="0,0,4,0"/>
                        <TextBlock Text="ì„¤ì •"/>
                    </StackPanel>
                </Button>
            </ToolBar>
        </ToolBarTray>

        <!-- í•„í„° ë° ê²€ìƒ‰ -->
        <Grid Grid.Row="1" Margin="4" Background="{DynamicResource {x:Static vsshell:VsBrushes.WindowKey}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- ì‹¬ê°ë„ í•„í„° -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="4">
                <TextBlock Text="í•„í„°:" VerticalAlignment="Center" Margin="0,0,8,0"
                          Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <CheckBox x:Name="ErrorCheckBox" Content="ì˜¤ë¥˜" IsChecked="True"
                         Margin="4,0" VerticalAlignment="Center"
                         Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed"
                         Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <CheckBox x:Name="WarningCheckBox" Content="ê²½ê³ " IsChecked="True"
                         Margin="4,0" VerticalAlignment="Center"
                         Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed"
                         Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <CheckBox x:Name="InfoCheckBox" Content="ì •ë³´" IsChecked="True"
                         Margin="4,0" VerticalAlignment="Center"
                         Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed"
                         Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
            </StackPanel>

            <!-- ê²€ìƒ‰ -->
            <Grid Grid.Column="1" Margin="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="SearchTextBox"
                        Grid.Column="0"
                        TextChanged="SearchTextBox_TextChanged"
                        VerticalAlignment="Center"
                        Padding="4,2"
                        Background="{DynamicResource {x:Static vsshell:VsBrushes.SearchBoxBackgroundKey}}"
                        Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                <TextBlock Grid.Column="0"
                          Text="ê²€ìƒ‰..."
                          VerticalAlignment="Center"
                          Margin="8,0,0,0"
                          Foreground="Gray"
                          IsHitTestVisible="False">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Text, ElementName=SearchTextBox}" Value="">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <Button Grid.Column="1" Content="ðŸ”"
                       Margin="4,0,0,0" Padding="8,2"
                       Click="SearchButton_Click"
                       Background="Transparent"
                       BorderThickness="0"/>
            </Grid>

            <!-- ê·¸ë£¹í™” ì˜µì…˜ -->
            <ComboBox x:Name="GroupByComboBox"
                     Grid.Column="2"
                     Width="120"
                     Margin="4"
                     SelectionChanged="GroupByComboBox_SelectionChanged"
                     Background="{DynamicResource {x:Static vsshell:VsBrushes.ComboBoxBackgroundKey}}"
                     Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}">
                <ComboBoxItem Content="íŒŒì¼ë³„" IsSelected="True"/>
                <ComboBoxItem Content="ê·œì¹™ë³„"/>
                <ComboBoxItem Content="ì‹¬ê°ë„ë³„"/>
            </ComboBox>
        </Grid>

        <!-- íŠ¸ë¦¬ë·° -->
        <Border Grid.Row="2"
               BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}"
               BorderThickness="1"
               Margin="4">
            <Grid>
                <!-- ë¡œë”© í‘œì‹œ -->
                <Grid x:Name="LoadingPanel" Visibility="Collapsed" Background="#80000000">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="0,0,0,10"/>
                        <TextBlock x:Name="LoadingText" Text="ë¶„ì„ ì¤‘..."
                                  HorizontalAlignment="Center"
                                  Foreground="White"
                                  FontSize="14"/>
                    </StackPanel>
                </Grid>

                <!-- ê²°ê³¼ íŠ¸ë¦¬ë·° -->
                <TreeView x:Name="ViolationsTreeView"
                         ItemsSource="{Binding}"
                         ItemTemplate="{StaticResource ViolationTemplate}"
                         ItemContainerStyle="{StaticResource TreeViewItemStyle}"
                         MouseDoubleClick="ViolationsTreeView_MouseDoubleClick"
                         Background="{DynamicResource {x:Static vsshell:VsBrushes.WindowKey}}"
                         BorderThickness="0">
                </TreeView>

                <!-- ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ -->
                <TextBlock x:Name="NoResultsText"
                          Text="ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. 'ìƒˆë¡œê³ ì¹¨' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¶„ì„ì„ ì‹œìž‘í•˜ì„¸ìš”."
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Foreground="Gray"
                          TextWrapping="Wrap"
                          Margin="20"
                          Visibility="Collapsed"/>
            </Grid>
        </Border>

        <!-- ìƒíƒœë°” -->
        <Border Grid.Row="3"
               Background="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarGradientKey}}"
               BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarBorderKey}}"
               BorderThickness="0,1,0,0"
               Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- ìœ„ë°˜ ê°œìˆ˜ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ì´ ìœ„ë°˜:" Margin="0,0,4,0"
                              Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                    <TextBlock x:Name="TotalViolationsText" Text="0" FontWeight="Bold"
                              Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                    <TextBlock Text=" | " Margin="8,0"
                              Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                    <TextBlock Text="ì˜¤ë¥˜:" Margin="0,0,4,0" Foreground="Red"/>
                    <TextBlock x:Name="ErrorCountText" Text="0" FontWeight="Bold" Foreground="Red"/>
                    <TextBlock Text=" | " Margin="8,0"
                              Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                    <TextBlock Text="ê²½ê³ :" Margin="0,0,4,0" Foreground="Orange"/>
                    <TextBlock x:Name="WarningCountText" Text="0" FontWeight="Bold" Foreground="Orange"/>
                    <TextBlock Text=" | " Margin="8,0"
                              Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
                    <TextBlock Text="ì •ë³´:" Margin="0,0,4,0" Foreground="Blue"/>
                    <TextBlock x:Name="InfoCountText" Text="0" FontWeight="Bold" Foreground="Blue"/>
                </StackPanel>

                <!-- ë¶„ì„ ì‹œê°„ -->
                <TextBlock Grid.Column="2" x:Name="AnalysisTimeText"
                          Text="ë§ˆì§€ë§‰ ë¶„ì„: -"
                          HorizontalAlignment="Right"
                          Foreground="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowTextKey}}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
