# 기능 명세서: TwinCAT 코드 품질 검증 및 리뷰 도구

**작성일**: 2025-11-20
**버전**: 1.0.0
**상태**: 초안 (Draft)

---

## 개요 (Overview)

### 목적 (Purpose)

TwinCAT 기반 온도 제어 및 자동 배치 프로세스 시스템의 PLC 코드에 대한 품질 검증(QA)과 코드 리뷰 프로세스를 자동화하고 효율화하는 도구를 제공합니다. 현재 수동으로 진행되어 비효율적인 코드 리뷰와 품질 검증 작업을 체계적이고 일관성 있게 수행할 수 있도록 지원합니다.

### 배경 (Background)

현재 시스템은 다음과 같은 복잡한 기능들을 포함하고 있습니다:
- **온도 모니터링 및 알람**: 다중 센서 모니터링, 임계값 기반 알람, 데이터 로깅
- **자동 배치 프로세스**: 단계별 시퀀스 제어, 레시피 관리, 상태 추적
- **통신 인터페이스**: EtherCAT, DeviceNet, RS-232를 통한 다중 유닛 데이터 처리

이러한 시스템의 TwinCAT PLC 코드를 QA 관점에서 검증하거나 코드 리뷰를 수행하는 것이 매우 불편하며, 다음과 같은 문제점이 있습니다:
- 수동 코드 리뷰로 인한 시간 소요 증가
- 일관성 없는 검증 기준
- 복잡한 통신 프로토콜과 상태 머신 로직의 검증 어려움
- 코드 품질 이슈 발견 지연

### 범위 (Scope)

**포함 사항**:
- TwinCAT PLC 코드 (IEC 61131-3 언어: ST, LD, FBD 등) 정적 분석
- 프로젝트 헌장 원칙 준수 여부 자동 검증
- 온도 제어 로직 및 레시피 관리 로직 특화 검증 규칙
- 통신 인터페이스 (EtherCAT, DeviceNet, RS-232) 관련 코드 패턴 검증
- 코드 품질 리포트 생성 및 시각화
- 코드 리뷰 체크리스트 자동 생성

**제외 사항**:
- 실시간 런타임 성능 분석 (프로파일링)
- 하드웨어 시뮬레이션 또는 에뮬레이션
- 자동 코드 수정 또는 리팩토링 (제안만 제공)
- 타사 라이브러리 내부 코드 분석

---

## 명확화 사항 (Clarifications)

### 세션 2025-11-20

- Q: 검증 실패 시 커밋 차단 정책은 어떻게 적용하나요? → A: Critical 위반만 차단, 나머지는 경고만 표시
- Q: Visual Studio 플러그인 UI 접근 방식은? → A: 전용 도구 창 (Tool Window) - 하단/측면 패널에 상시 표시
- Q: 사이클로매틱 복잡도 임계값 기준은? → A: 복잡도 10 이상 Medium 경고, 15 이상 High 경고
- Q: 검증 결과 데이터 보존 기간은? → A: 12개월 보관, 이후 선택적 아카이빙
- Q: Visual Studio 플러그인 배포 방법은? → A: Visual Studio Marketplace와 VSIX 파일 직접 설치 모두 지원

---

## 사용자 시나리오 및 테스트 (User Scenarios & Testing)

### 주요 사용자 (Primary Users)

1. **QA 엔지니어**: 배포 전 코드 품질 검증 수행
2. **시니어 개발자**: 주니어 개발자 코드 리뷰 수행
3. **프로젝트 관리자**: 코드 품질 메트릭 모니터링

### 사용 시나리오

#### 시나리오 1: 코드 커밋 전 자동 검증

**사용자**: 개발자
**목표**: Git 커밋 전 코드 품질 자동 검증

**단계**:
1. 개발자가 TwinCAT 프로젝트 코드를 수정
2. Git 커밋 시도 시 자동으로 품질 검증 도구 실행
3. 검증 결과 확인 (통과/실패)
4. 실패 시 상세 문제점 및 수정 제안 확인
5. 문제 수정 후 재검증
6. 통과 시 커밋 완료

**수락 기준**:
- 커밋 시 자동으로 검증이 트리거됨
- 검증 결과가 3초 이내에 표시됨
- 실패 원인이 파일명, 라인 번호와 함께 명확히 표시됨

#### 시나리오 2: 온도 제어 로직 특화 검증

**사용자**: QA 엔지니어
**목표**: 온도 제어 관련 Function Block의 안전성 검증

**단계**:
1. QA 엔지니어가 검증 대상 프로젝트 선택
2. 온도 제어 특화 검증 규칙 선택
3. 검증 실행
4. 다음 항목들이 자동으로 검증됨:
   - 센서 데이터 유효성 검사 누락 여부
   - 임계값 범위 초과 시 안전 로직 존재 여부
   - 비상 정지 조건 처리 여부
   - 상태 머신 모든 상태 전이 경로 완전성
5. 검증 리포트 생성 및 다운로드

**수락 기준**:
- 온도 제어 관련 모든 Function Block이 검증 대상에 포함됨
- 안전 관련 위반 사항은 "Critical" 등급으로 표시됨
- 검증 리포트는 PDF 또는 HTML 형식으로 제공됨

#### 시나리오 3: 통신 인터페이스 코드 패턴 검증

**사용자**: 시니어 개발자
**목표**: EtherCAT/DeviceNet/RS-232 통신 코드의 오류 처리 검증

**단계**:
1. 시니어 개발자가 리뷰 대상 코드 선택
2. 통신 인터페이스 검증 규칙 활성화
3. 다음 패턴들이 자동으로 검증됨:
   - 통신 타임아웃 처리 존재 여부
   - 재연결 로직 구현 여부
   - 데이터 무결성 검증 (CRC, 체크섬 등) 여부
   - 통신 에러 시 시스템 안전 상태 전환 여부
4. 위반 사항 리스트 확인
5. 각 위반 사항에 대한 코드 위치 및 수정 제안 확인

**수락 기준**:
- 모든 통신 관련 Function Block에서 타임아웃 처리 누락 시 경고 발생
- 재연결 로직이 없는 경우 권고 사항으로 표시
- 각 위반 사항마다 관련 헌장 원칙 참조 링크 제공

#### 시나리오 4: 레시피 관리 로직 일관성 검증

**사용자**: QA 엔지니어
**목표**: 레시피 로드/저장 로직의 데이터 무결성 검증

**단계**:
1. QA 엔지니어가 레시피 관리 모듈 선택
2. 레시피 검증 규칙 실행
3. 다음 항목 자동 검증:
   - 레시피 데이터 구조 타입 일관성
   - 레시피 로드 시 유효성 검사 존재 여부
   - 레시피 버전 관리 로직 존재 여부
   - 잘못된 레시피 데이터 처리 로직 존재 여부
4. 검증 결과 요약 대시보드 확인
5. 상세 리포트 다운로드

**수락 기준**:
- 모든 레시피 관련 DUT (Data Unit Type)가 자동으로 식별됨
- 유효성 검사 누락 시 "High" 우선순위로 표시됨
- 대시보드에서 전체 레시피 모듈 품질 점수 확인 가능

#### 시나리오 5: 프로젝트 전체 코드 품질 리포트 생성

**사용자**: 프로젝트 관리자
**목표**: 전체 프로젝트의 코드 품질 현황 파악

**단계**:
1. 프로젝트 관리자가 전체 프로젝트 스캔 실행
2. 모든 검증 규칙 자동 적용
3. 다음 메트릭이 포함된 종합 리포트 생성:
   - 전체 코드 라인 수
   - 헌장 원칙 준수율 (%)
   - 위반 사항 개수 (Critical/High/Medium/Low 등급별)
   - 모듈별 품질 점수
   - 시간 경과에 따른 품질 추세 (과거 스캔 결과와 비교)
4. 리포트를 팀원들과 공유

**수락 기준**:
- 1000줄 이상의 코드도 5분 이내에 스캔 완료
- 리포트는 그래프와 차트를 포함하여 시각적으로 제공됨
- 과거 리포트와 비교하여 개선/악화 추세 확인 가능

#### 시나리오 6: Git Diff 기반 증분 코드 리뷰

**사용자**: 시니어 개발자, QA 엔지니어
**목표**: 변경된 코드만 집중적으로 검증하여 코드 리뷰 효율성 극대화

**단계**:
1. 개발자가 코드 수정 완료 후 Git 커밋 준비
2. Visual Studio 플러그인에서 검증 모드 선택:
   - **전체 검증**: 프로젝트 전체 코드 검증
   - **변경 부분만 검증**: Git diff 기반으로 변경된 라인만 검증
3. "변경 부분만 검증" 모드 선택 시:
   - Git diff를 자동으로 분석하여 변경된 파일 및 라인 식별
   - 추가/수정/삭제된 코드에 대해서만 검증 규칙 적용
   - 변경 전 코드와 변경 후 코드 비교 결과 표시
4. 검증 결과 확인:
   - 변경 부분에서 발견된 위반 사항 목록
   - 변경으로 인해 새로 발생한 위반 vs 기존 위반 구분
   - 변경으로 인해 해결된 위반 사항 표시
5. 리뷰 리포트 생성:
   - "변경 전 vs 변경 후" 비교 섹션 포함
   - 코드 품질 개선/악화 지표 (예: +3 위반, -5 위반 = 전체적으로 개선)
6. 리포트를 코드 리뷰어에게 공유

**수락 기준**:
- Git diff 분석 시간 < 3초 (100개 파일 기준)
- 변경 부분만 검증 시 전체 검증 대비 80% 이상 시간 절약
- 변경으로 인한 신규 위반과 기존 위반을 명확히 구분하여 표시
- 변경 전후 코드를 나란히 비교할 수 있는 UI 제공 (Visual Studio 내)
- Git 스테이징된 변경, 커밋 간 차이, 브랜치 간 차이 모두 지원

**이점**:
- 대규모 프로젝트에서도 빠른 검증 가능
- 리뷰어는 변경 사항에만 집중하여 리뷰 시간 단축
- 코드 변경이 품질을 개선했는지 악화시켰는지 즉시 파악

---

## 기능 요구사항 (Functional Requirements)

### FR-1: 정적 코드 분석

**설명**: TwinCAT PLC 코드를 파싱하고 정적 분석 수행

**요구사항**:
- IEC 61131-3 표준 언어 (ST, LD, FBD, SFC) 파싱 지원
- Function Block, Program, DUT, GVL 파일 자동 인식
- 구문 오류 및 의미 오류 감지
- 코드 복잡도 측정 (사이클로매틱 복잡도)

**수락 기준**:
- 최소 500줄의 ST 코드를 10초 이내에 파싱
- 구문 오류 위치를 파일명, 라인 번호, 컬럼으로 정확히 지정
- **복잡도 경고 기준**:
  - 복잡도 10 이상: Medium 등급 경고
  - 복잡도 15 이상: High 등급 경고
  - Function Block별 복잡도 측정 및 리포트에 표시

### FR-2: 헌장 원칙 준수 검증

**설명**: 프로젝트 헌장에 정의된 8가지 원칙 자동 검증

**요구사항**:
- **원칙 1 (한글 우선)**: 주석이 한글인지 자동 검증
- **원칙 2 (실시간 안전성)**: 비상 정지 로직 존재 여부, 사이클 타임 고려 여부 검증
- **원칙 3 (모듈화)**: Function Block 사용 여부, 단일 책임 원칙 준수 검증
- **원칙 4 (상태 머신)**: 상태 전이 완전성 검증
- **원칙 5 (명명 규칙)**: 변수/함수 명명 규칙 준수 검증
- **원칙 6 (문서화)**: 주석 존재 여부 및 품질 검증
- **원칙 7 (버전 관리)**: Git 커밋 메시지 형식 검증 (Git 훅 연동)
- **원칙 8 (테스트)**: 테스트 케이스 존재 여부 검증

**수락 기준**:
- 각 원칙별 준수율을 백분율로 표시
- 위반 사항마다 해당 원칙 번호 및 설명 링크 제공
- 전체 헌장 준수 점수 산출 (0-100점)

### FR-3: 온도 제어 로직 특화 규칙

**설명**: 온도 모니터링, 알람, 센서 처리 관련 특화 검증

**요구사항**:
- 센서 데이터 범위 검증 로직 존재 확인
- 임계값 초과 시 알람 발생 로직 존재 확인
- 센서 고장 감지 및 폴백 로직 존재 확인
- 온도 제어 루프의 안정성 검증:
  - 출력 변화율 임계값: 1초(1 사이클) 당 10% 이상 변화 시 경고
  - 연속된 급격한 변화 감지: 3회 연속 10% 이상 변화 시 High 경고
  - 안정화 로직 존재 확인: 점진적 출력 조정 로직 (예: 램프 업/다운) 검증

**수락 기준**:
- 온도 관련 변수명 패턴 (예: `temp`, `temperature`, `sensor`) 자동 인식
- 센서 데이터 유효성 검사 누락 시 "Critical" 경고
- 알람 처리 로직 누락 시 "High" 경고

### FR-4: 레시피 관리 로직 검증

**설명**: 레시피 로드, 저장, 검증 로직의 무결성 확인

**요구사항**:
- 레시피 데이터 구조 (DUT) 일관성 검증
- 레시피 로드 시 유효성 검사 존재 확인
- 레시피 버전 관리 메커니즘 존재 확인
- 잘못된 레시피 처리 로직 존재 확인

**수락 기준**:
- 레시피 관련 DUT 자동 식별 (명명 패턴 또는 주석 기반)
- 유효성 검사 누락 시 경고 발생
- 버전 관리 필드 (예: `version`, `timestamp`) 누락 시 권고 표시

### FR-5: 통신 인터페이스 코드 패턴 검증

**설명**: EtherCAT, DeviceNet, RS-232 통신 코드의 안정성 검증

**요구사항**:
- 통신 타임아웃 처리 존재 확인
- 재연결 로직 존재 확인
- 데이터 무결성 검증 (CRC, 체크섬) 존재 확인
- 통신 에러 시 안전 상태 전환 로직 존재 확인

**수락 기준**:
- 통신 관련 Function Block 자동 식별
- 타임아웃 처리 누락 시 "High" 경고
- 에러 처리 누락 시 "Critical" 경고

### FR-6: 상태 머신 검증

**설명**: CASE 문 기반 상태 머신의 완전성 및 안전성 검증

**요구사항**:
- 모든 정의된 상태(ENUM)가 CASE 문에서 처리되는지 확인
- 기본(default) 케이스 또는 ELSE 처리 존재 확인
- 데드락 또는 무한 루프 가능성 경고:
  - **상태 전이 그래프 순환 탐지**: 동일 상태로 되돌아오는 경로 분석
  - **탈출 조건 검증**: 각 상태에서 최종 상태 또는 안전 상태로 가는 경로 존재 확인
  - **무한 대기 감지**: 특정 조건 없이 동일 상태 유지 시 Medium 경고
  - **복잡도 기반 경고**: 상태 전이 경로가 10개 이상인 경우 리뷰 권장
- 각 상태에서 다음 상태로의 전이 조건 명확성 확인

**수락 기준**:
- ENUM 타입 상태 변수 자동 인식
- 미처리 상태 발견 시 "Critical" 경고
- 기본 케이스 누락 시 "High" 경고

### FR-7: 명명 규칙 검증

**설명**: 프로젝트 헌장에 정의된 명명 규칙 자동 검증

**요구사항**:
- Function Block: `FB_` 접두사 검증
- 전역 변수: `g` 접두사 검증
- 로컬 변수: camelCase 검증
- 상수: UPPER_CASE 검증
- DUT: `T_` 접두사 검증
- ENUM: `E_` 접두사 검증

**수락 기준**:
- 명명 규칙 위반 시 파일명, 라인 번호, 변수명 표시
- 각 위반 사항에 올바른 명명 예시 제공
- 전체 명명 규칙 준수율 산출

### FR-8: 주석 및 문서화 품질 검증

**설명**: 코드 주석의 존재 여부 및 품질 검증

**요구사항**:
- 모든 Function Block에 목적 설명 주석 존재 확인
- 복잡한 로직 (복잡도 > 10)에 설명 주석 존재 확인
- 주석이 한글로 작성되었는지 확인
- 주석과 코드의 일치성 검증 (제한적 범위):
  - **TODO/FIXME 주석 추적**: 주석에 "TODO" 또는 "FIXME" 키워드가 있는 경우 해당 코드 블록이 미완성 상태인지 확인
  - **변수명-주석 일치**: 주석에 언급된 변수명이 실제 코드에 존재하는지 확인
  - **상태 설명 일치**: 주석에 명시된 상태명(ENUM)이 실제 CASE 문에 존재하는지 확인
  - **한계**: 자연어 주석의 의미론적 분석은 1차 버전에서 제외 (향후 AI 기반 검증 고려)

**수락 기준**:
- Function Block 주석 누락 시 "Medium" 경고
- 복잡한 로직 주석 누락 시 "High" 경고
- 한글 주석 비율 산출 (목표: 95% 이상)

### FR-9: 코드 품질 리포트 생성

**설명**: 검증 결과를 종합한 리포트 생성

**요구사항**:
- HTML 또는 PDF 형식 리포트 생성
- 다음 내용 포함:
  - 전체 요약 (코드 라인 수, 위반 개수, 준수율)
  - 위반 사항 목록 (등급별, 파일별)
  - 모듈별 품질 점수
  - 시간 경과에 따른 품질 추세 그래프
  - 수정 제안 및 우선순위
- 리포트 내 코드 스니펫 하이라이팅
  - IEC 61131-3 언어별 구문 하이라이팅 지원:
    - **Structured Text (ST)**: 키워드, 변수, 주석 색상 구분
    - **Ladder Diagram (LD)**: 그래픽 요소를 텍스트 설명으로 표현 시 구조 강조
    - **Function Block Diagram (FBD)**: 블록 연결 관계를 들여쓰기로 표현
  - HTML 리포트: CSS 기반 색상 하이라이팅
  - PDF 리포트: 폰트 스타일 (굵게, 이탤릭) 및 음영 처리

**수락 기준**:
- 리포트 생성 시간 < 5초 (1000줄 코드 기준)
- 그래프 및 차트 포함
- 위반 사항 클릭 시 해당 코드 위치로 이동 가능 (HTML 리포트)

### FR-10: Git 훅 연동

**설명**: Git 커밋 시 자동으로 코드 검증 실행

**요구사항**:
- Git pre-commit 훅 자동 설치
- 커밋 시도 시 변경된 파일만 선택적으로 검증
- **차단 정책**:
  - Critical 심각도 위반 발견 시: 커밋 차단 및 상세 에러 메시지 표시
  - High/Medium/Low 심각도 위반: 경고 메시지만 표시하고 커밋 허용
  - 모든 위반 사항은 커밋 후에도 리포트에 기록
- 검증 통과 또는 경고만 있는 경우 커밋 진행

**수락 기준**:
- 훅 설치 후 커밋 시 자동으로 검증 실행
- 검증 시간 < 10초 (변경 파일 기준)
- Critical 위반 시 커밋 차단 및 명확한 실패 원인 표시
- High 이하 위반 시 경고 표시 후 커밋 허용
- 경고 건수가 리포트에 요약되어 표시

### FR-11: 설정 및 커스터마이징

**설명**: 검증 규칙 및 임계값 사용자 정의 가능

**요구사항**:
- 설정 파일 (YAML 또는 JSON) 제공
- 각 검증 규칙 활성화/비활성화 가능
- 복잡도, 주석 비율 등 임계값 조정 가능
- 프로젝트별 커스텀 규칙 추가 가능:
  - **설정 파일 기반 정규식 규칙**:
    - YAML/JSON 파일에 정규식 패턴, 위반 메시지, 심각도 정의
    - 예: 특정 변수명 패턴 강제, 금지어 검출 등
  - **플러그인 인터페이스** (선택 사항):
    - 커스텀 검증 로직을 DLL 플러그인으로 작성 가능
    - 표준 인터페이스 (`IValidationRule`) 구현
    - 플러그인 디렉토리에 배치 시 자동 로드
  - **템플릿 제공**: 일반적인 커스텀 규칙 예시 (예: 회사별 명명 규칙, 산업별 안전 규칙)

**수락 기준**:
- 설정 파일 변경 후 즉시 적용
- 잘못된 설정 시 명확한 에러 메시지 표시
- 기본 설정 파일 템플릿 제공

**실행 환경**: Visual Studio TwinCAT 플러그인으로 개발하여 TwinCAT XAE 환경에 완전히 통합됩니다. 이를 통해 개발자는 Visual Studio 내에서 코드 작성과 동시에 실시간 품질 피드백을 받을 수 있으며, TwinCAT 프로젝트 구조에 대한 네이티브 접근이 가능합니다.

### FR-12: Diff 기반 증분 검증 및 코드 비교

**설명**: Git diff를 활용하여 변경된 코드만 선택적으로 검증하고, 변경 전후 코드 품질을 비교

**요구사항**:
- **검증 모드 선택**:
  - 전체 검증: 프로젝트 전체 코드 검증
  - 증분 검증: Git diff 기반으로 변경된 부분만 검증
  - Visual Studio 플러그인 UI에서 모드 전환 가능
- **Git 통합**:
  - Git diff 자동 분석 (스테이징 영역, 워킹 디렉토리, 커밋 간, 브랜치 간)
  - 변경된 파일 및 라인 번호 정확히 식별
  - 추가/수정/삭제 코드 각각 처리
- **증분 검증 로직**:
  - 변경된 라인에 대해서만 검증 규칙 적용
  - 변경이 영향을 미치는 범위 자동 분석:
    - **Function Block (FB) 내부 변경**: 해당 FB 전체를 컨텍스트로 포함
    - **상태 머신 CASE 문 변경**: 전체 CASE 블록을 컨텍스트로 포함
    - **전역 변수 선언 변경**: 해당 변수를 참조하는 모든 코드 블록 포함
    - **주석만 변경**: 해당 주석이 설명하는 코드 블록 (변경 라인 기준 ±5줄) 포함
  - **컨텍스트 범위 정의**:
    - 기본 컨텍스트: 변경된 라인을 포함하는 최소 논리 단위 (예: IF 블록, CASE 블록, FOR 루프)
    - 확장 컨텍스트: 변경이 영향을 미치는 상위 스코프 (예: 변경된 변수를 사용하는 모든 라인)
    - 주변 코드 참조 범위: 변경 라인 기준 상하 각 10줄 (명명 규칙, 주석 품질 검증용)
- **변경 전후 비교**:
  - 변경 전 코드의 위반 사항 기록
  - 변경 후 코드의 위반 사항 검출
  - 신규 발생 위반, 해결된 위반, 여전히 남은 위반 구분
  - 품질 개선/악화 지표 산출 (예: 품질 점수 변화)
- **비교 리포트**:
  - "변경 전 vs 변경 후" 섹션 포함
  - Side-by-side 코드 비교 뷰 (Visual Studio 내)
  - 변경 사항 요약: +N개 신규 위반, -M개 해결된 위반
  - 전체 품질 점수 변화 그래프

**수락 기준**:
- Git diff 분석 완료 시간 < 3초 (100개 파일 기준)
- 증분 검증 시간은 전체 검증 대비 80% 이상 단축
- 신규/해결/기존 위반을 명확히 구분하여 시각적으로 표시
- 변경 전후 코드를 나란히 비교할 수 있는 UI 제공
- 변경 사항이 없는 파일은 검증 대상에서 자동 제외
- 대규모 변경(500줄 이상) 시에도 10초 이내 증분 검증 완료

**이점**:
- 대규모 프로젝트에서 빠른 피드백 제공
- 코드 리뷰 시 변경 사항에만 집중 가능
- 코드 변경이 품질 개선에 기여했는지 즉시 확인
- Git 워크플로우와 자연스럽게 통합

---

## 성공 기준 (Success Criteria)

1. **검증 속도**: 1000줄의 PLC 코드를 5분 이내에 전체 검증 완료
2. **정확도**: 헌장 원칙 위반 사항을 95% 이상의 정확도로 감지
3. **커밋 시간 단축**: Git 커밋 전 수동 리뷰 시간을 기존 대비 70% 단축
4. **품질 향상**: 도구 도입 후 3개월 내 프로덕션 버그 발생률 40% 감소
5. **사용자 만족도**: QA 엔지니어 및 개발자 만족도 조사에서 4.0/5.0 이상 달성
6. **리포트 생성**: 경영진 보고용 품질 리포트를 5분 이내에 생성 가능
7. **학습 곡선**: 신규 사용자가 30분 이내에 기본 검증 실행 가능
8. **오탐률**: False Positive (잘못된 경고) 비율 10% 이하 유지

---

## 핵심 엔티티 (Key Entities)

### 엔티티 1: 코드 파일 (Code File)

**속성**:
- 파일 경로 (절대 경로)
- 파일 타입 (POU, DUT, GVL 등)
- 프로그래밍 언어 (ST, LD, FBD, SFC)
- 코드 라인 수
- 마지막 수정 날짜

### 엔티티 2: 검증 규칙 (Validation Rule)

**속성**:
- 규칙 ID (고유 식별자)
- 규칙 이름 (한글)
- 규칙 설명
- 연관된 헌장 원칙 (1-8)
- 위반 심각도 (Critical, High, Medium, Low)
- 활성화 여부

### 엔티티 3: 위반 사항 (Violation)

**속성**:
- 위반 ID
- 연관된 코드 파일
- 라인 번호
- 컬럼 번호
- 위반 규칙 ID
- 위반 설명 (한글)
- 수정 제안 (선택적)
- 발견 날짜/시간

### 엔티티 4: 검증 세션 (Validation Session)

**속성**:
- 세션 ID
- 실행 시간 (시작/종료)
- 검증 대상 프로젝트 경로
- 스캔한 파일 개수
- 발견된 위반 개수 (등급별)
- 전체 품질 점수 (0-100)
- 실행한 사용자

### 엔티티 5: 품질 리포트 (Quality Report)

**속성**:
- 리포트 ID
- 생성 날짜/시간
- 연관된 검증 세션 ID
- 리포트 형식 (HTML, PDF)
- 파일 경로
- 요약 통계 (코드 라인 수, 위반 개수, 준수율 등)

### 엔티티 6: 설정 프로파일 (Configuration Profile)

**속성**:
- 프로파일 이름
- 활성화된 규칙 목록
- 임계값 설정 (복잡도, 주석 비율 등)
- 커스텀 규칙 정의
- 기본 프로파일 여부

**데이터 저장 방식**: 모든 검증 결과 데이터는 로컬 파일 시스템에 저장됩니다. 검증 세션 결과, 리포트, 메트릭 등은 프로젝트 디렉토리 내 `.twincat-qa/` 폴더에 JSON 및 HTML/PDF 형식으로 보관되며, 개발자가 직접 버전 관리하거나 팀원들과 공유할 수 있습니다.

---

## 비기능 요구사항 (Non-Functional Requirements)

### 성능 (Performance)

- 1000줄 코드 검증 시간 < 5분
- Git 커밋 시 증분 검증 시간 < 10초
- 리포트 생성 시간 < 5초
- 동시에 5개 이상의 검증 세션 처리 가능 (서버 모드인 경우)

### 사용성 (Usability)

- **Visual Studio 통합**:
  - 전용 도구 창 (Tool Window)을 Visual Studio 하단 또는 측면 패널에 제공
  - 도구 창은 View 메뉴에서 접근 가능
  - 검증 결과, 위반 사항 목록, 품질 점수를 실시간으로 표시
  - 위반 사항 클릭 시 해당 코드 위치로 자동 이동
- 에러 메시지는 한글로 명확히 표시
- 설정 파일은 주석과 예시 포함
- 사용자 가이드 문서 제공 (한글)

### 호환성 (Compatibility)

- Windows 10/11 지원
- TwinCAT 3.1 이상 버전 지원
- Git 2.0 이상과 연동 가능
- Visual Studio 2019/2022 지원

### 배포 및 설치 (Deployment)

- **배포 방법**:
  - Visual Studio Marketplace를 통한 자동 설치 및 업데이트 (권장)
  - VSIX 패키지 파일 직접 다운로드 및 수동 설치 (오프라인 환경)
- 설치 후 자동으로 View 메뉴에 도구 창 추가
- 자동 업데이트 지원 (Marketplace 설치 시)
- 버전 호환성 체크 및 경고 표시

### 보안 (Security)

- 민감한 코드 정보는 리포트 외부로 유출 금지
- 설정 파일에 비밀번호 평문 저장 금지
- 로컬 실행 시 네트워크 통신 불필요 (오프라인 동작)

### 유지보수성 (Maintainability)

- 새로운 검증 규칙 추가가 용이한 플러그인 구조
- 모든 코드 및 문서는 한글 주석 포함
- 단위 테스트 커버리지 80% 이상

### 협업 및 공유 (Collaboration)

검증 결과는 리포트 파일(HTML, PDF)을 생성하여 수동으로 공유합니다. 개발자는 생성된 리포트를 이메일, 파일 서버, 또는 프로젝트 관리 도구에 첨부하여 팀원들과 공유할 수 있습니다. 이 방식은 추가 인프라 없이 간단하게 시작할 수 있으며, 기존 협업 워크플로우에 자연스럽게 통합됩니다.

---

## 가정 사항 (Assumptions)

1. **개발 환경**: 개발자들은 Windows 환경에서 TwinCAT 3.1 이상을 사용 중
2. **Git 사용**: 모든 프로젝트는 Git으로 버전 관리 중
3. **파일 접근**: 검증 도구는 TwinCAT 프로젝트 파일 (.tsproj, .TcPOU 등)에 읽기 접근 가능
4. **언어**: 주석은 한글로 작성되는 것이 기본 원칙이나, 일부 영어 주석도 존재 가능 (검증 시 경고)
5. **네트워크**: 오프라인 환경에서도 기본 검증 기능 동작
6. **데이터 보존**: 검증 결과는 12개월간 로컬 `.twincat-qa/` 폴더에 보관되며, 이후 사용자가 선택적으로 아카이빙하거나 삭제 가능. 12개월 이상 경과된 데이터는 자동으로 아카이브 제안 알림 표시
7. **리소스**: 검증 실행 시 CPU 사용률 < 50%, 메모리 < 2GB
8. **테스트 케이스**: 테스트 케이스는 별도 `/tests` 디렉토리에 문서화되어 있음
9. **통신 프로토콜**: EtherCAT, DeviceNet, RS-232 통신은 Beckhoff 표준 라이브러리 사용
10. **오류 처리**: 검증 도구 자체의 오류는 로그 파일에 기록하고 사용자에게 명확히 안내

---

## 제약 사항 (Constraints)

1. **플랫폼**: Windows 전용 (Linux/macOS 미지원)
2. **TwinCAT 버전**: TwinCAT 3.1 이상만 지원 (TwinCAT 2 미지원)
3. **파일 크기**: 단일 PLC 파일 크기 > 10,000줄인 경우 성능 저하 가능
4. **언어 지원**: IEC 61131-3 표준 언어만 지원 (C++ 모듈은 제외)
5. **실시간 분석**: 런타임 성능 분석은 포함되지 않음 (정적 분석만)
6. **자동 수정**: 코드 자동 수정 기능은 제공하지 않음 (제안만)
7. **라이선스**: 상용 정적 분석 도구 라이선스는 프로젝트 예산 범위 내에서만 사용
8. **데이터베이스**: 중앙 데이터베이스 구축은 1차 버전에서 선택 사항

---

## 의존성 (Dependencies)

### 외부 의존성

1. **TwinCAT XAE**: 코드 파일 구조 이해를 위해 TwinCAT 설치 필요
2. **Git**: Git 훅 연동을 위해 Git 2.0 이상 설치 필요
3. **파서 라이브러리**: IEC 61131-3 언어 파싱을 위한 외부 라이브러리 (또는 자체 개발)

### 내부 의존성

1. **프로젝트 헌장**: `/memory/constitution.md` 파일에 정의된 원칙 참조
2. **명명 규칙**: CLAUDE.md 파일에 정의된 TwinCAT 명명 규칙 참조
3. **테스트 케이스**: `/tests` 디렉토리의 테스트 시나리오 참조

---

## 향후 고려사항 (Future Considerations)

1. **실시간 성능 프로파일링**: 런타임 환경에서 실제 사이클 타임 측정 기능
2. **자동 리팩토링 제안**: AI 기반 코드 개선 제안 및 자동 적용
3. **클라우드 통합**: 팀 전체 품질 메트릭을 클라우드 대시보드에서 실시간 모니터링
4. **CI/CD 통합**: Jenkins, GitHub Actions 등과 연동하여 자동화된 품질 게이트 구축
5. **다국어 지원**: 영어 주석 및 리포트 지원 (글로벌 협업 시)
6. **머신러닝**: 과거 버그 패턴 학습하여 버그 예측 기능
7. **시뮬레이션 연동**: TwinCAT 시뮬레이터와 연동하여 동적 검증 수행
8. **모바일 앱**: 모바일에서 품질 리포트 확인 및 알림 수신

---

## 부록 (Appendix)

### 용어 정리

- **PLC**: Programmable Logic Controller (프로그래머블 로직 컨트롤러)
- **TwinCAT**: The Windows Control and Automation Technology (Beckhoff의 PC 기반 제어 플랫폼)
- **IEC 61131-3**: PLC 프로그래밍 언어 국제 표준
- **Function Block (FB)**: 입력/출력을 가진 재사용 가능한 프로그램 모듈
- **DUT**: Data Unit Type (구조체, 열거형 등 사용자 정의 데이터 타입)
- **GVL**: Global Variable List (전역 변수 목록)
- **ST**: Structured Text (고급 텍스트 기반 PLC 언어)
- **EtherCAT**: Ethernet for Control Automation Technology (실시간 산업용 이더넷 프로토콜)
- **DeviceNet**: 산업 자동화용 네트워크 프로토콜
- **RS-232**: 직렬 통신 표준

### 참조 문서

- `/memory/constitution.md`: 프로젝트 헌장 (8대 핵심 원칙)
- `/CLAUDE.md`: TwinCAT 프로젝트 개발 가이드
- IEC 61131-3 표준 문서
- Beckhoff TwinCAT 3 공식 문서

---

**이 명세서는 비즈니스 요구사항과 사용자 가치에 초점을 맞추고 있으며, 구체적인 기술 구현 방법은 계획 단계에서 결정됩니다.**
